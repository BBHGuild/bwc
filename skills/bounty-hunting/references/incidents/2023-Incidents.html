<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>2023 Incidents - Blockchain Weakness Classification (BWC)</title>


        <!-- Google tag (gtag.js) -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-HDV7VPQ8R3"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());

          gtag('config', 'G-HDV7VPQ8R3');
        </script>

        <!-- Custom HTML head -->

        <meta name="description" content="A comprehensive taxonomy for EVM vulnerabilities, mapped to 10 years of incident analysis (2016-2026).">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <!-- Twitter Card data -->
        <meta name="twitter:card" content="summary_large_image">
        <meta name="twitter:title" content="2023 Incidents - Blockchain Weakness Classification (BWC)">
        <meta name="twitter:description" content="A comprehensive taxonomy for EVM vulnerabilities, mapped to 10 years of incident analysis (2016-2026).">
        <meta name="twitter:image" content="https://bbhguild.github.io/bwc/skills/bounty-hunting/references/assets/BWC-2021-2026.png">

        <link rel="icon" href="../../../../favicon.svg">
        <link rel="shortcut icon" href="../../../../favicon.png">
        <link rel="stylesheet" href="../../../../css/variables.css">
        <link rel="stylesheet" href="../../../../css/general.css">
        <link rel="stylesheet" href="../../../../css/chrome.css">
        <link rel="stylesheet" href="../../../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../../../../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../../../../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../../../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../../../../theme/pagetoc.css">
        <link rel="stylesheet" href="../../../../theme/collapsible.css">


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../../../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Blockchain Weakness Classification (BWC)</h1>

                    <div class="right-buttons">
                        <a href="../../../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/BBHGuild/bwc/" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://x.com/BBHGuild/" title="X (Twitter)" aria-label="X (Twitter)">
                            <i id="x-link" class="fa fa-twitter"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <div class="content-wrap">
                            <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="2023-evm-contract-vulnerability-incidents-classification--analysis"><a class="header" href="#2023-evm-contract-vulnerability-incidents-classification--analysis">2023 EVM Contract Vulnerability Incidents Classification &amp; Analysis.</a></h1>
<p>This database uses the <a href="../../../../README.html">BWC</a> to classify Contract Vulnerability Incidents. Note off-chain issues have been excluded they're the most prevalent and resulted in more values lost. Humans remains to be the weakest point human stupidity or ingenuity(depending on how you look at it) could be infinite. It's unfeasible to track it.</p>
<hr />
<h2 id="2023-06-22---1"><a class="header" href="#2023-06-22---1">2023-06-22 - 1</a></h2>
<ul>
<li><strong>Date</strong>: 2023-06-22 (Disclosure Date)</li>
<li><strong>Project</strong>: General EIP-2612 Implementations</li>
<li><strong>Value Lost</strong>: $0 (Vulnerability Disclosure)</li>
<li><strong>Chain</strong>: EVM</li>
<li><strong>BWC</strong>:
<ul>
<li><strong>Broader Classification</strong>: <code>BWC 8: Denial of Service (DoS) Vulnerabilities</code></li>
<li><strong>Primary Classification</strong>: <code>BWC 8.11: DoS via Front-Running (Griefing)</code></li>
<li><strong>Secondary Classification</strong>: <code>BWC 5.1.1: Front-Running</code></li>
</ul>
</li>
<li><strong>Description</strong>:
<ul>
<li>Security researchers at Trust Security detailed a Denial of Service vector known as "Permit Griefing" affecting contracts integrating EIP-2612.</li>
<li><strong>The Flaw:</strong> Many contracts implement a "multicall" or "permit-then-execute" flow where <code>permit()</code> is called to set token allowances before executing a trade or deposit. The contracts typically expect the <code>permit()</code> call to succeed and will revert the entire transaction if it fails.</li>
<li><strong>The Exploit:</strong> Because the permit signature is visible in the mempool, an attacker can front-run the user's transaction and submit the <code>permit()</code> call themselves. The attacker's transaction succeeds, consuming the user's nonce and granting the approval. However, when the user's transaction subsequently attempts to call <code>permit()</code> with the same (now used) nonce, it reverts. Although the approval exists, the user's intent (the trade or deposit) is blocked.</li>
</ul>
</li>
<li><strong>References</strong>:
<ul>
<li><a href="https://www.trust-security.xyz/post/permission-denied">Trust Security: Permission Denied</a></li>
</ul>
</li>
</ul>
<hr />
<h2 id="2023-12-06---1"><a class="header" href="#2023-12-06---1">2023-12-06 - 1</a></h2>
<ul>
<li><strong>Date</strong>: 2023-12-06</li>
<li><strong>Project</strong>: TIME Contract ERC2771 Exploit</li>
<li><strong>Value Lost</strong>: $212,000</li>
<li><strong>Chain</strong>: Ethereum Mainnet</li>
<li><strong>BWC</strong>:
<ul>
<li>Broader Classification: BWC 4: Input &amp; Data Validation Vulnerabilities</li>
<li>Primary Classification: BWC 4.4.1: ERC-2771 + Multicall</li>
</ul>
</li>
<li><strong>Description</strong>:
<ul>
<li>The TIME contract was exploited due to a vulnerability in its <code>multicall</code> function, which was set as a trusted forwarder for ERC-2771 meta-transactions. The issue stemmed from the <code>multicall</code> function not complying with the ERC-2771 standard for trusted forwarders.</li>
<li><strong>The Flaw:</strong> A compliant trusted forwarder must append the original <code>msg.sender</code> (20 bytes) to the end of the calldata it forwards. The TIME contract's <code>multicall</code> function failed to do this.</li>
<li>
<pre><code class="language-javascript">// Flawed Multicall implementation
function aggregate(Call[] calldata calls) public payable returns (uint256 blockNumber, bytes[] memory returnData) {
    ...
    (success, returnData[i]) = call.target.call(call.callData); // Fails to append msg.sender
    ...
}
</code></pre>
</li>
<li><strong>The Mechanism:</strong> The <code>ERC2771Context</code> contract, used for handling meta-transactions, retrieves the sender's address by reading the last 20 bytes of the calldata it receives from a trusted forwarder.</li>
<li>
<pre><code class="language-javascript">// ERC2771Context logic to extract sender
function _msgSender() internal view virtual override returns (address sender) {
    if (isTrustedForwarder(msg.sender) &amp;&amp; msg.data.length &gt;= 20) {
        assembly {
            sender := shr(96, calldataload(sub(calldatasize(), 20)))
        }
    } else {
        return super._msgSender();
    }
}
</code></pre>
</li>
<li><strong>The Exploit:</strong> Because the flawed <code>multicall</code> didn't append the real sender, the last 20 bytes of the <em>original calldata provided by the attacker</em> were read by <code>_msgSender</code>. This allowed the attacker to craft a call where the last 20 bytes contained any address they wished to impersonate, such as the contract's owner, thereby bypassing access controls and draining funds.</li>
<li><strong>The Fix:</strong> A secure <code>multicall</code> implementation appends the sender, ensuring the correct address is forwarded.</li>
<li>
<pre><code class="language-javascript">// Secure Multicall3 implementation
function aggregate(Call[] calldata calls) public payable returns (uint256 blockNumber, bytes[] memory returnData) {
    ...
    (success, returnData[i]) = call.target.call(abi.encodePacked(call.callData, msg.sender)); // Correctly appends msg.sender
    ...
}
</code></pre>
</li>
</ul>
</li>
<li><strong>References</strong>:
<ul>
<li><a href="https://etherscan.io/tx/0xecdd111a60debfadc6533de30fb7f55dc5ceed01dfadd30e4a7ebdb416d2f6b6">Time Exploit </a></li>
<li><a href="https://blog.openzeppelin.com/arbitrary-address-spoofing-vulnerability-erc2771context-multicall-public-disclosure">Openzeppelin ERC2771 disclosure</a></li>
</ul>
</li>
</ul>
<hr />
<h2 id="2023-09-25---1"><a class="header" href="#2023-09-25---1">2023-09-25 - 1</a></h2>
<ul>
<li><strong>Date</strong>: 2023-09-25 (Disclosure Date)</li>
<li><strong>Project</strong>: Multiple Smart Accounts (ERC-1271 Implementations)</li>
<li><strong>Value Lost</strong>: $0 (Critical Vulnerability Disclosure)</li>
<li><strong>Chain</strong>: EVM Chains (Multi-chain)</li>
<li><strong>BWC</strong>:
<ul>
<li><strong>Broader Classification</strong>: <code>BWC 4: Input &amp; Data Validation Vulnerabilities</code></li>
<li><strong>Primary Classification</strong>: <code>BWC 4.3.2: Incomplete Signature Schemes</code></li>
<li><strong>Secondary Classification</strong>: <code>BWC 4.3.1: Missing Signature Validation</code></li>
</ul>
</li>
<li><strong>Description</strong>:
<ul>
<li>A widespread vulnerability was identified in the implementation of ERC-1271 <code>isValidSignature</code> across multiple smart account providers.</li>
<li><strong>The Flaw:</strong> The standard implementation often only verified that the signature recovered to the correct <code>owner</code> address. It failed to verify that the signature was intended <em>specifically</em> for the contract instance receiving it.</li>
<li><strong>The Exploit:</strong> If a user deployed multiple smart accounts (e.g., <code>Account A</code> and <code>Account B</code>) controlled by the same EOA key, a valid signature intended for <code>Account A</code> (e.g., a Permit signature) could be replayed on <code>Account B</code> because <code>Account B</code> only checked if the signer was the owner (which was true). This allowed attackers to replay authorizations across different accounts or chains owned by the same user.</li>
<li><strong>Vulnerable Code Pattern:</strong>
<pre><code class="language-solidity">function isValidSignature(bytes32 _hash, bytes calldata _signature) external view returns (bytes4) {
    // VULNERABLE: Only checks signer identity, not the destination scope
    if (recoverSigner(_hash, _signature) == owner) {
        return 0x1626ba7e;
    } else {
        return 0xffffffff;
    }
}
</code></pre>
</li>
</ul>
</li>
<li><strong>References</strong>:
<ul>
<li><a href="https://mirror.xyz/curiousapple.eth/pFqAdW2LiJ-6S4sg_u1z08k4vK6BCJ33LcyXpnNb8yU">Curious Apple Mirror Post</a></li>
<li><a href="https://www.alchemy.com/blog/erc-1271-replay-vulnerability">Alchemy Security Update</a></li>
</ul>
</li>
</ul>
<p>Itâ€™s important to emphasize that the intent behind this content is not to criticize or blame the affected projects but to provide objective overviews that serve as educational material for the community to learn from and better protect projects in the future.</p>

                        </div>
                        <div id="sidetoc">
                            <nav id="pagetoc"></nav>
                        </div>
                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../../../skills/bounty-hunting/references/incidents/2024-Incidents.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../../../skills/bounty-hunting/references/incidents/2022-Incidents.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../../../skills/bounty-hunting/references/incidents/2024-Incidents.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../../../skills/bounty-hunting/references/incidents/2022-Incidents.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../../../elasticlunr.min.js"></script>
        <script src="../../../../mark.min.js"></script>
        <script src="../../../../searcher.js"></script>

        <script src="../../../../clipboard.min.js"></script>
        <script src="../../../../highlight.js"></script>
        <script src="../../../../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../../../../theme/pagetoc.js"></script>
        <script src="../../../../theme/collapsible.js"></script>


        <!-- Back to Top Button -->
        <button id="back-to-top" title="Go to Top">
            <i class="fa fa-arrow-up"></i>
        </button>

    </div>
    </body>
</html>
